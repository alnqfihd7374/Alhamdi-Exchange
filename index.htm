<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أبوالحسن الحامدي للصرافة</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Tajawal', sans-serif; transition: background-color 0.4s ease; }
        
        /* Smooth Transitions */
        .fade-in-up { animation: fadeInUp 0.5s ease forwards; }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .input-focus-effect:focus { transform: scale(1.01); box-shadow: 0 10px 15px -3px rgba(16, 185, 129, 0.1); }
        .tap-effect:active { transform: scale(0.95); }
        
        /* Custom Checkbox as Toggles */
        .toggle-bg { background: #e5e7eb; transition: background 0.3s; }
        .dark .toggle-bg { background: #374151; }
        
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body class="bg-gray-50 text-slate-800 dark:bg-slate-950 dark:text-slate-100 min-h-screen">

    <header class="p-6 max-w-2xl mx-auto flex justify-between items-center">
        <div>
            <h1 class="text-2xl font-black text-emerald-700 dark:text-emerald-500" id="header-title">أبوالحسن الحامدي</h1>
            <p class="text-xs text-gray-400 font-medium tracking-wide uppercase" id="header-subtitle">التميز في الصرافة</p>
        </div>
        <div class="flex gap-3">
            <button onclick="toggleLang()" class="w-10 h-10 flex items-center justify-center rounded-2xl bg-white dark:bg-slate-900 shadow-sm border border-gray-100 dark:border-slate-800 text-xs font-bold" id="lang-btn">EN</button>
            <button onclick="toggleTheme()" class="w-10 h-10 flex items-center justify-center rounded-2xl bg-white dark:bg-slate-900 shadow-sm border border-gray-100 dark:border-slate-800">
                <i data-lucide="sun" id="theme-icon" class="w-5 h-5 text-amber-500"></i>
            </button>
        </div>
    </header>

    <main class="max-w-2xl mx-auto px-6 pb-24">
        
        <div class="bg-white dark:bg-slate-900 rounded-[2.5rem] p-8 shadow-2xl shadow-gray-200/50 dark:shadow-none border border-white/20 relative overflow-hidden">
            
            <div class="flex items-center justify-between gap-4 mb-10">
                <div class="flex-1">
                    <span class="text-[10px] font-bold text-gray-400 uppercase mb-2 block" id="label-from">من</span>
                    <select id="fromCurrency" onchange="runCalc()" class="w-full bg-transparent text-2xl font-black outline-none cursor-pointer">
                        <option value="SAR">SAR</option>
                        <option value="USD">USD</option>
                        <option value="YER">YER</option>
                    </select>
                </div>
                <button onclick="swap()" class="tap-effect bg-emerald-600 text-white p-4 rounded-3xl shadow-lg shadow-emerald-500/30 transition-transform hover:rotate-180 duration-500">
                    <i data-lucide="repeat" class="w-6 h-6"></i>
                </button>
                <div class="flex-1 text-left">
                    <span class="text-[10px] font-bold text-gray-400 uppercase mb-2 block text-left" id="label-to">إلى</span>
                    <select id="toCurrency" onchange="runCalc()" class="w-full bg-transparent text-2xl font-black outline-none cursor-pointer text-left">
                        <option value="YER">YER</option>
                        <option value="USD">USD</option>
                        <option value="SAR">SAR</option>
                    </select>
                </div>
            </div>

            <div class="mb-10">
                <label class="text-xs font-bold text-emerald-600 mb-3 block" id="label-amount">المبلغ المُراد تحويله</label>
                <input type="number" 
                       inputmode="decimal" 
                       id="amount" 
                       placeholder="0.00" 
                       oninput="runCalc()"
                       class="input-focus-effect w-full bg-gray-50 dark:bg-slate-800/50 p-6 rounded-[2rem] text-4xl font-black outline-none transition-all border-2 border-transparent focus:border-emerald-500">
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div class="bg-gray-100 dark:bg-slate-800 p-1.5 rounded-[1.5rem] flex gap-1">
                    <button id="m-sanaa" onclick="setM('sanaa')" class="flex-1 py-3 text-xs font-bold rounded-xl transition-all bg-white dark:bg-slate-700 shadow-sm" id="btn-sanaa">صنعاء</button>
                    <button id="m-aden" onclick="setM('aden')" class="flex-1 py-3 text-xs font-bold rounded-xl text-gray-400" id="btn-aden">عدن</button>
                </div>
                <div class="bg-gray-100 dark:bg-slate-800 p-1.5 rounded-[1.5rem] flex gap-1">
                    <button id="t-buy" onclick="setT('buy')" class="flex-1 py-3 text-xs font-bold rounded-xl transition-all bg-white dark:bg-slate-700 shadow-sm" id="btn-buy">شراء</button>
                    <button id="t-sell" onclick="setT('sell')" class="flex-1 py-3 text-xs font-bold rounded-xl text-gray-400" id="btn-sell">بيع</button>
                </div>
            </div>
        </div>

        <div id="result-card" class="hidden mt-8 fade-in-up">
            <div class="bg-emerald-600 rounded-[2.5rem] p-8 text-white shadow-xl shadow-emerald-500/20 relative overflow-hidden">
                <div class="relative z-10 text-center">
                    <p id="rate-msg" class="text-xs text-emerald-100 mb-2 opacity-80 font-medium"></p>
                    <div class="flex items-center justify-center gap-3">
                        <span id="res-val" class="text-5xl font-black">0.00</span>
                        <span id="res-cur" class="text-xl font-bold opacity-70">YER</span>
                    </div>
                </div>
                <div class="flex justify-center gap-3 mt-8 relative z-10">
                    <button onclick="copyRes()" class="tap-effect bg-white/20 hover:bg-white/30 p-4 rounded-2xl backdrop-blur-md transition-all">
                        <i data-lucide="copy" class="w-5 h-5 text-white"></i>
                    </button>
                    <button onclick="shareWA()" class="tap-effect bg-white text-emerald-700 font-bold px-6 py-4 rounded-2xl flex items-center gap-2 shadow-lg">
                        <i data-lucide="share-2" class="w-5 h-5"></i>
                        <span id="share-text">مشاركة النتيجة</span>
                    </button>
                    <button onclick="saveResultToNote()" class="tap-effect bg-emerald-800 text-white p-4 rounded-2xl transition-all">
                        <i data-lucide="plus-square" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>
        </div>

        <div class="mt-12">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-black flex items-center gap-2">
                    <i data-lucide="book-open" class="text-emerald-600"></i>
                    <span id="notes-title">ملاحظاتي</span>
                </h3>
                <button onclick="openForm()" class="tap-effect bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400 px-5 py-2.5 rounded-2xl text-xs font-black" id="add-note-btn">+ جديد</button>
            </div>
            
            <div id="note-form" class="hidden fade-in-up mb-6 bg-white dark:bg-slate-900 p-6 rounded-3xl border border-gray-100 dark:border-slate-800">
                <input type="text" id="n-title" placeholder="العنوان" class="w-full bg-gray-50 dark:bg-slate-800 p-4 rounded-2xl mb-3 outline-none focus:ring-2 ring-emerald-500/20">
                <textarea id="n-body" placeholder="اكتب تفاصيلك هنا..." class="w-full bg-gray-50 dark:bg-slate-800 p-4 rounded-2xl h-32 outline-none focus:ring-2 ring-emerald-500/20"></textarea>
                <button onclick="saveN()" class="w-full bg-emerald-600 text-white py-4 rounded-2xl font-bold mt-4 shadow-lg shadow-emerald-500/20" id="save-note-btn">حفظ الملاحظة</button>
            </div>

            <div id="notes-list" class="grid gap-4"></div>
        </div>
    </main>

    <script>
        // Rates & Settings
        const rates = {
            sanaa: { USD: { buy: 534, sell: 536 }, SAR: { buy: 139.80, sell: 140.30 } },
            aden: { USD: { buy: 1609, sell: 1620 }, SAR: { buy: 423, sell: 423 } }
        };

        const langData = {
            ar: {
                title: "أبوالحسن الحامدي", from: "من", to: "إلى", amount: "المبلغ المراد تحويله",
                sanaa: "صنعاء", aden: "عدن", buy: "شراء", sell: "بيع", share: "مشاركة عبر واتساب",
                notes: "ملاحظاتي", add: "+ جديد", rateText: "سعر {side} {cur} في {market}: {rate}",
                saveNote: "حفظ الملاحظة", titlePH: "العنوان", bodyPH: "التفاصيل..."
            },
            en: {
                title: "Al-Hamdi Ex", from: "From", to: "To", amount: "Amount to convert",
                sanaa: "Sanaa", aden: "Aden", buy: "Buy", sell: "Sell", share: "Share to WhatsApp",
                notes: "My Notes", add: "+ New", rateText: "{side} rate for {cur} in {market}: {rate}",
                saveNote: "Save Note", titlePH: "Title", bodyPH: "Details..."
            }
        };

        let currentLang = 'ar';
        let market = 'sanaa';
        let type = 'buy';
        let notes = JSON.parse(localStorage.getItem('hamdi_notes_v2')) || [];

        // Core Functions
        function toggleLang() {
            currentLang = currentLang === 'ar' ? 'en' : 'ar';
            document.documentElement.dir = currentLang === 'ar' ? 'rtl' : 'ltr';
            document.getElementById('lang-btn').innerText = currentLang === 'ar' ? 'EN' : 'العربية';
            updateUI();
        }

        function updateUI() {
            const l = langData[currentLang];
            document.getElementById('header-title').innerText = l.title;
            document.getElementById('label-from').innerText = l.from;
            document.getElementById('label-to').innerText = l.to;
            document.getElementById('label-amount').innerText = l.amount;
            document.getElementById('m-sanaa').innerText = l.sanaa;
            document.getElementById('m-aden').innerText = l.aden;
            document.getElementById('t-buy').innerText = l.buy;
            document.getElementById('t-sell').innerText = l.sell;
            document.getElementById('notes-title').innerText = l.notes;
            document.getElementById('add-note-btn').innerText = l.add;
            document.getElementById('share-text').innerText = l.share;
            document.getElementById('save-note-btn').innerText = l.saveNote;
            document.getElementById('n-title').placeholder = l.titlePH;
            document.getElementById('n-body').placeholder = l.bodyPH;
            runCalc();
            renderNotes();
        }

        function runCalc() {
            const amt = parseFloat(document.getElementById('amount').value);
            const from = document.getElementById('fromCurrency').value;
            const to = document.getElementById('toCurrency').value;
            const card = document.getElementById('result-card');

            if (!amt || from === to) { card.classList.add('hidden'); return; }
            card.classList.remove('hidden');

            let res = 0; let rateUsed = 0;
            if (from !== 'YER' && to === 'YER') {
                rateUsed = rates[market][from][type];
                res = amt * rateUsed;
            } else if (from === 'YER' && to !== 'YER') {
                rateUsed = rates[market][to][type];
                res = amt / rateUsed;
            } else {
                let toYer = amt * rates[market][from][type];
                rateUsed = rates[market][to][type];
                res = toYer / rateUsed;
            }

            document.getElementById('res-val').innerText = res.toLocaleString(undefined, {maximumFractionDigits: 2});
            document.getElementById('res-cur').innerText = to;
            
            const l = langData[currentLang];
            document.getElementById('rate-msg').innerText = l.rateText
                .replace('{side}', l[type]).replace('{cur}', from).replace('{market}', l[market]).replace('{rate}', rateUsed);
        }

        function setM(m) { 
            market = m; 
            document.getElementById('m-sanaa').className = m === 'sanaa' ? 'flex-1 py-3 text-xs font-bold rounded-xl transition-all bg-white dark:bg-slate-700 shadow-sm' : 'flex-1 py-3 text-xs font-bold rounded-xl text-gray-400';
            document.getElementById('m-aden').className = m === 'aden' ? 'flex-1 py-3 text-xs font-bold rounded-xl transition-all bg-white dark:bg-slate-700 shadow-sm' : 'flex-1 py-3 text-xs font-bold rounded-xl text-gray-400';
            runCalc(); 
        }

        function setT(t) { 
            type = t; 
            document.getElementById('t-buy').className = t === 'buy' ? 'flex-1 py-3 text-xs font-bold rounded-xl transition-all bg-white dark:bg-slate-700 shadow-sm' : 'flex-1 py-3 text-xs font-bold rounded-xl text-gray-400';
            document.getElementById('t-sell').className = t === 'sell' ? 'flex-1 py-3 text-xs font-bold rounded-xl transition-all bg-white dark:bg-slate-700 shadow-sm' : 'flex-1 py-3 text-xs font-bold rounded-xl text-gray-400';
            runCalc(); 
        }

        function swap() {
            const f = document.getElementById('fromCurrency');
            const t = document.getElementById('toCurrency');
            [f.value, t.value] = [t.value, f.value];
            runCalc();
        }

        function shareWA() {
            const val = document.getElementById('res-val').innerText;
            const cur = document.getElementById('res-cur').innerText;
            const msg = document.getElementById('rate-msg').innerText;
            const text = encodeURIComponent(`*أبوالحسن الحامدي للصرافة*\nالنتيجة: ${val} ${cur}\n${msg}\n_تم التحويل عبر التطبيق الذكي_`);
            window.open(`https://wa.me/?text=${text}`);
        }

        function saveResultToNote() {
            const val = document.getElementById('res-val').innerText;
            const cur = document.getElementById('res-cur').innerText;
            const msg = document.getElementById('rate-msg').innerText;
            document.getElementById('n-title').value = currentLang === 'ar' ? "عملية تحويل" : "Conversion Result";
            document.getElementById('n-body').value = `${val} ${cur}\n${msg}`;
            openForm();
        }

        // Notes Logic
        function saveN() {
            const title = document.getElementById('n-title').value;
            const body = document.getElementById('n-body').value;
            if(!title) return;
            notes.unshift({ id: Date.now(), title, body, date: new Date().toLocaleDateString() });
            localStorage.setItem('hamdi_notes_v2', JSON.stringify(notes));
            renderNotes();
            openForm(); // Close
        }

        function renderNotes() {
            const list = document.getElementById('notes-list');
            list.innerHTML = notes.map(n => `
                <div class="bg-white dark:bg-slate-900 p-6 rounded-[2rem] border border-gray-100 dark:border-slate-800 shadow-sm">
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="font-bold text-emerald-700 dark:text-emerald-400">${n.title}</h4>
                        <button onclick="delN(${n.id})" class="text-red-400"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                    </div>
                    <p class="text-xs text-gray-500 mb-3">${n.body}</p>
                    <span class="text-[9px] text-gray-300 font-bold">${n.date}</span>
                </div>
            `).join('');
            lucide.createIcons();
        }

        function delN(id) { notes = notes.filter(n => n.id !== id); localStorage.setItem('hamdi_notes_v2', JSON.stringify(notes)); renderNotes(); }
        function openForm() { document.getElementById('note-form').classList.toggle('hidden'); }
        function toggleTheme() { 
            document.body.classList.toggle('dark'); 
            const isDark = document.body.classList.contains('dark');
            document.getElementById('theme-icon').setAttribute('data-lucide', isDark ? 'sun' : 'moon');
            lucide.createIcons();
        }
        function copyRes() { navigator.clipboard.writeText(document.getElementById('res-val').innerText); alert('تم النسخ!'); }

        window.onload = () => { lucide.createIcons(); updateUI(); };
    </script>
</body>
</html>
